

## 分而治之

Git所使用的Myers diff线性变种采用一种叫做*Snake*(有时也叫*Middle Snake*)的概念分解整个搜索过程，一条Snake在编辑图中意味着一步左移/下移后跟0~N步对角线移动。 Myers diff的线性变种会在一条最优的编辑路径上寻找居于中间位置中间的Snake, 并通过它将整个编辑图分割为两个部分。接下来的步骤则如法炮制，分别对分割出的两块子图运用相同的技术进行分割，最终得到一条完整的编辑路径。

```
    0   1   2   3   4   5   6   7   8   9  10  11  12  13  14
 0  o---o---o---o---o---o---o
    |   |   |   |   |   |   |
 1  o---o---o---o---o---o---o
    |   | \ |   |   |   |   |
 2  o---o---o---o---o---o---o
    |   |   |   |   |   |   |
 3  o---o---o---o---o---o---o
    |   |   |   |   | \ |   |
 4  o---o---o---o---o---o---o
    |   |   |   |   |   |   |
 5  o---o---o---o---o---o---o
                              \
 6                              @
                                  \
 7                                  @---o---o---o---o---o---o
                                        |   |   |   |   |   |
 8                                      o---o---o---o---o---o
                                        | \ |   |   |   |   |
 9                                      o---o---o---o---o---o
                                        |   |   |   |   |   |
10                                      o---o---o---o---o---o
                                        |   |   |   |   |   |
11                                      o---o---o---o---o---o
                                        |   |   | \ |   |   |
12                                      o---o---o---o---o---o
                                        |   |   |   |   |   |
13                                      o---o---o---o---o---o
                                        |   |   |   |   | \ |
14                                      o---o---o---o---o---o
```

> 稍微回顾一下前文，最优编辑路径指的是到终点距离最短(对角线距离为零)，这样的编辑路径不止一条。

细心的读者想必已经发现了，以上论述存在先有鸡还是先有蛋的问题：要得到一条Snake, 必须先有一条最优的编辑路径，但是要得到一条最优的编辑路径，目前看来唯一的办法是跑一遍原版myers算法。

实际上，线性myers算法的思路基本就是这样，但它采取了一种不大寻常的思路：同时从左上角和右下角使用原版myers算法交替进行搜索，但是不保存历史记录，只检查两边的搜索过程是否重叠，一旦重叠，就将重叠部分作为Middle Snake返回。

听起来思路很清晰，但还有些东西需要搞清楚。从后往前搜索时，对角线坐标就不能再用k了，我们需要定义一个新的对角线坐标**c = k - delta**。它和k是互为镜像的，这样正好满足从反方向向起点搜索的需求。

```
        x                       k
                                  0     1     2     3
        0     1     2     3         \     \     \     \
  y  0  o-----o-----o-----o           o-----o-----o-----o
        |     |     |     |      -1   |     |     |     | \
        |     |     |     |         \ |     |     |     |   2
     1  o-----o-----o-----o           o-----o-----o-----o
        |     | \   |     |      -2   |     | \   |     | \
        |     |   \ |     |         \ |     |   \ |     |   1
     2  o-----o-----o-----o           o-----o-----o-----o
                                        \     \     \     \
                                        -3    -2    -1      0
                                                              c
```

